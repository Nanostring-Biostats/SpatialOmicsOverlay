# Get the gene symbol that are mapped to an entrez gene identifiers
mapped_genes <- mappedkeys(x)
# Convert to a list
genes <- unlist(as.list(x[mapped_genes]))
#species in metadata matches folder label
test_that("species in metadata matches folder label",{
expect_identical(metadata$Species, as.character(dataset["Species"]))
})
if(!grepl("COVID",metadata$`Profile Matrix`)){
#age in metadata matches folder label
test_that("age in metadata matches folder label", {
expect_identical(metadata$`Age Group`, as.character(dataset["Age"]))
})
}
#check URLs in metadata are valid
# test_that("URLs in metadata are valid", {
#   expect_true(all(lapply(str_split(metadata$URL, ", ", simplify = T),
#                          FUN =  url.exists) == TRUE))
# })
#genes in profile matrix are the same format as species panel genes
test_that("genes in profile matrix are valid organism genes", {
expect_gte(length(which(rownames(profile_matrix) %in% genes))/nrow(profile_matrix), 0.8)
})
#check unique column names
test_that("unique cell types", {
expect_false(any(duplicated(colnames(profile_matrix))))
